C51 COMPILER V9.54   XPT2046                                                               07/13/2023 19:46:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE XPT2046
OBJECT MODULE PLACED IN .\Objects\Xpt2046.obj
COMPILER INVOKED BY: D:\App\Keil5\C51\BIN\C51.EXE Xpt2046.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\Xpt2046.lst) TABS(2) OBJECT(.\Objects\Xpt2046.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          //引脚定义
   4          sbit Xpt2046_Din=P3^4;
   5          sbit Xpt2046_CS=P3^5;
   6          sbit Xpt2046_DCLK=P3^6;
   7          sbit Xpt2046_DOUT=P3^7;
   8          
   9          /**
  10            * @brief  XPT2046读取AD值
  11            * @param  Command 命令字，范围：头文件内定义的宏，结尾的数字表示转换的位数
  12            * @retval AD转换后的数字量，范围：8位为0~255，12位为0~4095
  13            */
  14          unsigned int Xpt2046_ReadAD(unsigned char Command)
  15          {
  16   1        unsigned char i=0;
  17   1        unsigned int Data=0;
  18   1        Xpt2046_CS=0;   
  19   1        Xpt2046_DCLK=0;
  20   1        
  21   1        for(i=0;i<8;i++)
  22   1        {
  23   2          Xpt2046_Din=Command&(0x80>>i);
  24   2          Xpt2046_DCLK=1;
  25   2          Xpt2046_DCLK=0;
  26   2        }
  27   1        for(i=0;i<16;i++)
  28   1        {
  29   2          Xpt2046_DCLK=1;
  30   2          Xpt2046_DCLK=0;
  31   2          if(Xpt2046_DOUT)Data|=(0x8000>>i);
  32   2        }
  33   1        Xpt2046_CS=1;
  34   1        Xpt2046_DCLK=0;
  35   1        
  36   1        return Data>>8;
  37   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     91    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
