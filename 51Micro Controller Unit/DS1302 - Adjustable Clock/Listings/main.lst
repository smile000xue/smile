C51 COMPILER V9.54   MAIN                                                                  06/25/2023 16:52:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\App\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Key.h"
   5          #include "Timer0.h"
   6          
   7          unsigned char KeyNumber,MODE,Select,flag;
   8          
   9          void TimeShow(void)
  10          {
  11   1        Read_time();  
  12   1        LCD_ShowNum(1,1,20,2);
  13   1        LCD_ShowNum(1,3,time[0],2);
  14   1        LCD_ShowNum(1,6,time[1],2);
  15   1        LCD_ShowNum(1,9,time[2],2);
  16   1        LCD_ShowNum(2,1,time[3],2);
  17   1        LCD_ShowNum(2,4,time[4],2);
  18   1        LCD_ShowNum(2,7,time[5],2);
  19   1      }
  20          
  21          void TimeSet(void)
  22          {
  23   1        if(KeyNumber==2)
  24   1        {
  25   2          Select++;
  26   2          Select%=6;
  27   2        }
  28   1        if(KeyNumber==3)
  29   1        {
  30   2          time[Select]++;
  31   2          if(time[0]>99){time[0]=0;}
  32   2          if(time[1]>12){time[1]=1;}
  33   2          if(time[1]==1||time[1]==3||time[1]==5||time[1]==7||time[1]==8||time[1]==10||time[1]==12)
  34   2          {
  35   3            if(time[2]>31){time[2]=1;}
  36   3          }
  37   2          if(time[1]==4||time[1]==6||time[1]==9||time[1]==11)
  38   2          {
  39   3            if(time[2]>30){time[2]=1;}
  40   3          }
  41   2          if(time[1]==2)
  42   2          {
  43   3            if((time[0]%4==0&&time[0]%100!=0)||time[0]%400==0)
  44   3            {if(time[2]>28){time[2]=1;}}
  45   3            else
  46   3            {if(time[2]>29){time[2]=1;}}
  47   3          }
  48   2          
  49   2          if(time[3]>23){time[3]=0;}
  50   2          if(time[4]>59){time[4]=0;}
  51   2          if(time[5]>59){time[5]=0;}
  52   2        }
  53   1        if(KeyNumber==4)
  54   1        {
C51 COMPILER V9.54   MAIN                                                                  06/25/2023 16:52:08 PAGE 2   

  55   2          time[Select]--;
  56   2          if(time[0]>100){time[0]=99;}
  57   2          if(time[1]<1){time[1]=12;}
  58   2          if(time[1]==1||time[1]==3||time[1]==5||time[1]==7||time[1]==8||time[1]==10||time[1]==12)
  59   2          {
  60   3            if(time[2]<1){time[2]=31;}
  61   3          }
  62   2          if(time[1]==4||time[1]==6||time[1]==9||time[1]==11)
  63   2          {
  64   3            if(time[2]<1){time[2]=30;}
  65   3            if(time[2]>30){time[2]=1;}
  66   3          }
  67   2          if(time[1]==2)
  68   2          {
  69   3            if((time[0]%4==0&&time[0]%100!=0)||time[0]%400==0)
  70   3            {if(time[2]<1){time[2]=28;}
  71   4             if(time[2]>28){time[2]=1;}}
  72   3            else
  73   3            {if(time[2]<1){time[2]=29;}
  74   4             if(time[2]>29){time[2]=1;}}
  75   3          }
  76   2          
  77   2          if(time[3]>24){time[3]=23;}
  78   2          if(time[4]>60){time[4]=59;}
  79   2          if(time[5]>60){time[5]=59;}
  80   2        }
  81   1        if(flag)
  82   1        {
  83   2          switch(Select)
  84   2          {
  85   3            case 0: LCD_ShowString(1,3,"  ");break;
  86   3            case 1: LCD_ShowString(1,6,"  ");break;
  87   3            case 2: LCD_ShowString(1,9,"  ");break;
  88   3            case 3: LCD_ShowString(2,1,"  ");break;
  89   3            case 4: LCD_ShowString(2,4,"  ");break;
  90   3            case 5: LCD_ShowString(2,7,"  ");break;
  91   3          }
  92   2        }
  93   1        else
  94   1        {
  95   2          LCD_ShowNum(1,1,20,2);
  96   2          LCD_ShowNum(1,3,time[0],2);
  97   2          LCD_ShowNum(1,6,time[1],2);
  98   2          LCD_ShowNum(1,9,time[2],2);
  99   2          LCD_ShowNum(2,1,time[3],2);
 100   2          LCD_ShowNum(2,4,time[4],2);
 101   2          LCD_ShowNum(2,7,time[5],2);
 102   2          
 103   2         }  
 104   1        
 105   1      }
 106          
 107          void main(void)
 108          {
 109   1        LCD_Init();
 110   1        DS1302_Init();
 111   1        Timer0Init();
 112   1        
 113   1        LCD_ShowString(1,3,"  -  -  ");//静态字符初始化显示
 114   1        LCD_ShowString(2,1,"  :  :  ");
 115   1      
 116   1        Set_time();
C51 COMPILER V9.54   MAIN                                                                  06/25/2023 16:52:08 PAGE 3   

 117   1        
 118   1        while(1)
 119   1        {
 120   2          KeyNumber=Key();
 121   2          
 122   2          if(KeyNumber==1)
 123   2          {
 124   3            if(MODE==0){MODE=1;Select=0;}
 125   3            else if(MODE==1){MODE=0;Set_time();}
 126   3          }
 127   2          switch(MODE)
 128   2          {
 129   3            case 0: TimeShow();break;
 130   3            case 1: TimeSet();break;
 131   3          }
 132   2        }
 133   1      }
 134          
 135          void Timer0_Routine() interrupt 1
 136          {
 137   1        static unsigned int T0Count;
 138   1        TL0 = 0x18;   //设置定时初值
 139   1        TH0 = 0xFC;   //设置定时初值
 140   1        T0Count++;
 141   1        if(T0Count>=500)
 142   1        {
 143   2          T0Count=0;
 144   2          flag=!flag;
 145   2        }
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    910    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
